- project:
    check:
      jobs:
        - openstack-tox-pep8:
            required-projects:
              - name: opendev.org/openstack/neutron
                override-checkout: stable/queens
        - openstack-tox-py27:
            required-projects:
              - name: opendev.org/openstack/neutron
                override-checkout: stable/queens
        - networking-nuage-tempest-smoke:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin /opt/stack/neutron-tempest-plugin"'
                Q_ML2_PLUGIN_TYPE_DRIVERS: vxlan,vlan,flat
              devstack_local_conf: &remove-mpls-driver-tempest
                test-config:
                  $TEMPEST_CONFIG:
                    neutron_plugin_options:
                      available_type_drivers: flat,vlan,local,vxlan
                    nuage_sut:
                      nuage_hybrid_mpls_enabled: False
            required-projects: &required-projects
              - name: OpenStack/nuage-openstack-neutron
                override-checkout: 6.0/queens
              - name: OpenStack/nuage-openstack-neutronclient
                override-checkout: 6.0/queens
              - name: opendev.org/openstack/neutron-tempest-plugin
                override-checkout: 0.3.0
    gate:
      jobs:
        - openstack-tox-pep8:
            required-projects:
              - name: opendev.org/openstack/neutron
                override-checkout: stable/queens
        - openstack-tox-py27:
            required-projects:
              - name: opendev.org/openstack/neutron
                override-checkout: stable/queens
        - networking-nuage-tempest-smoke:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin /opt/stack/neutron-tempest-plugin"'
                Q_ML2_PLUGIN_TYPE_DRIVERS: vxlan,vlan,flat
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
    virtio:
      jobs:
        - networking-nuage-tempest-virtio:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: &remove-mpls-driver-devstack
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
                Q_ML2_PLUGIN_TYPE_DRIVERS: vxlan,vlan,flat
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
    sriov:
      jobs:
        - networking-nuage-tempest-sriov:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-tempest-sriov-flat-vlan:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
    baremetal:
      jobs:
        - networking-nuage-tempest-baremetal:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
    full:
      jobs:
        - networking-nuage-tempest-virtio:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-tempest-sriov:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-tempest-sriov-flat-vlan:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-tempest-baremetal:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
        - networking-nuage-tempest-scenario:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
    agent:
      jobs:
        - networking-nuage-tempest-qdhcp:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
    fwaas:
      jobs:
        - legacy-tempest-aio-fwaas:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
            required-projects: *required-projects
    octavia:
      jobs:
        - networking-nuage-octavia:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin /opt/stack/octavia-tempest-plugin /opt/stack/nuage-octavia-tempest-plugin"'
                IMAGE_URLS: "http://openstack-infra.an.nuagenetworks.net/nuage-glance-images/cirros-ipv6.qcow2, http://openstack-infra.an.nuagenetworks.net/nuage-glance-images/octavia/queens/amphora-x64-haproxy.qcow2"
            required-projects: *required-projects
        - networking-nuage-octavia-standby:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin /opt/stack/octavia-tempest-plugin /opt/stack/nuage-octavia-tempest-plugin"'
                IMAGE_URLS: "http://openstack-infra.an.nuagenetworks.net/nuage-glance-images/cirros-ipv6.qcow2, http://openstack-infra.an.nuagenetworks.net/nuage-glance-images/octavia/queens/amphora-x64-haproxy.qcow2"
            required-projects: *required-projects
    sfc:
      jobs:
        - legacy-tempest-aio-sfc
    rally:
      jobs:
        - networking-nuage-rally-task:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
            required-projects: *required-projects
    switchdev:
      jobs:
        - networking-nuage-tempest-api-switchdev:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
    cli:
      jobs:
        - networking-nuage-tempest-cli:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
    aggregateflows:
      jobs:
        - networking-nuage-tempest-aggregateflows:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
    scenario:
      jobs:
        - networking-nuage-tempest-scenario:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
    scale:
      jobs:
        - networking-nuage-tempest-scale:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
    upstream:
      jobs:
        - tempest-full:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                TEMPEST_PLUGINS: '"/opt/stack/neutron-tempest-plugin"'
            required-projects: *required-projects
    periodic:
      jobs:
        - networking-nuage-tempest-virtio:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-tempest-sriov:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-tempest-baremetal:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
        - networking-nuage-tempest-cli:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
        - networking-nuage-tempest-scenario:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
        - tempest-full:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/neutron-tempest-plugin"'
            required-projects: *required-projects
        - networking-nuage-tempest-api-switchdev:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
    periodic-saturday:
      jobs:
        - networking-nuage-tempest-qdhcp:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-tempest-sriov-flat-vlan:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc: *remove-mpls-driver-devstack
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-rally-task:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
    periodic-sunday:
      jobs:
        - networking-nuage-tempest-aggregateflows:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
        - networking-nuage-tempest-scale:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin"'
            required-projects: *required-projects
        - networking-nuage-tempest-smoke-multiversion:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                Q_ML2_PLUGIN_TYPE_DRIVERS: vxlan,vlan,flat
              devstack_local_conf: *remove-mpls-driver-tempest
            required-projects: *required-projects
        - networking-nuage-octavia:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                IMAGE_URLS: "http://openstack-infra.an.nuagenetworks.net/nuage-glance-images/cirros-ipv6.qcow2, http://openstack-infra.an.nuagenetworks.net/nuage-glance-images/octavia/queens/amphora-x64-haproxy.qcow2"
            required-projects: *required-projects
        - networking-nuage-octavia-standby:
            override-checkout: stable/queens
            vars:
              vsp_release: '6.0'
              devstack_localrc:
                USE_PYTHON3: false
                FORCE_CONFIG_DRIVE: false
                IMAGE_URLS: "http://openstack-infra.an.nuagenetworks.net/nuage-glance-images/cirros-ipv6.qcow2, http://openstack-infra.an.nuagenetworks.net/nuage-glance-images/octavia/queens/amphora-x64-haproxy.qcow2"
            required-projects: *required-projects

- job:
    name: networking-nuage-rally-task
    parent: rally-task-at-devstack
    branches: ^(?!stable/(newton|ocata|pike)).*$
    nodeset: openstack-single-node
    override-checkout: stable/queens
    required-projects:
      - name: opendev.org/openstack/devstack
      - name: opendev.org/openstack/devstack-gate
      - name: opendev.org/openstack/rally
      - name: opendev.org/openstack/rally-openstack
      - name: OpenStack/nuage-openstack-neutron
        override-checkout: 6.0/queens
    pre-run: playbooks/pre-run.yaml
    irrelevant-files:
      - ^(test-|)requirements.txt$
      - ^.*\.rst$
      - ^doc/.*$
      - ^releasenotes/.*$
      - ^setup.cfg$
      - ^tools/.*$
      - ^tox.ini$
    vars:
      vsp_release: '6.0'
      use_pypi: true
      nuage_fip_range: "172.{{ 255 | random }}.{{ 255 | random }}"
      devstack_plugins:
        rally-openstack: https://this.url.is.not.used.but.needs.to.stay
        nuage-openstack-neutron: https://github.com/nuagenetworks/nuage-openstack-neutron.git
      devstack_services:
        q-agt: false
        q-dhcp: false
        q-l3: false
        q-meta: false
        q-metering: false
      devstack_localrc:
        FLOATING_RANGE: "{{ nuage_fip_range }}.0/24"
        PUBLIC_NETWORK_GATEWAY: "{{ nuage_fip_range }}.1"
        Q_PLUGIN: ml2
        Q_USE_PROVIDERNET_FOR_PUBLIC: False
        Q_ML2_PLUGIN_EXT_DRIVERS: nuage_subnet,nuage_port,port_security,nuage_network
        Q_ML2_PLUGIN_MECHANISM_DRIVERS: nuage
        Q_ML2_PLUGIN_TYPE_DRIVERS: vxlan
        NUAGE_VSD_DEF_NETPART_NAME: "NuageCi-{{ 1000000 | random }}"
        NUAGE_FIP_UNDERLAY: True
        NUAGE_USE_METADATA: True
        NUAGE_METADATA_SHARED_SECRET: sharedsecret
        NUAGE_PAT: legacy_disabled
        OVS_BRIDGE: alubr0
      rally_task: rally-jobs/nuage-openstack-neutron.yaml
    timeout: 7800

- job:
    name: legacy-tempest-aio-sfc
    parent: legacy-dsvm-base
    run: playbooks/tempest-aio-sfc/run.yaml
    post-run: playbooks/tempest-aio-sfc/post.yaml
    nodeset: devstack-single-node
    vars:
      vsp_release: '6.0'
      job_flavor: sfc
      branch_override: default
    timeout: 9000
    override-checkout: stable/queens
    required-projects:
      - OpenStack/nuage-gate-utils
      - name: OpenStack/nuage-openstack-neutron
        override-checkout: 6.0/queens
      - name: OpenStack/nuage-openstack-neutronclient
        override-checkout: 6.0/queens
      - OpenStack/nuage-tempest-plugin
      - opendev.org/openstack/networking-sfc
      - name: opendev.org/openstack/neutron-tempest-plugin
        override-checkout: 0.3.0
      - opendev.org/openstack/python-neutronclient
      - opendev.org/openstack/tempest

- job:
    name: legacy-tempest-aio-fwaas
    parent: legacy-dsvm-base
    run: playbooks/tempest-aio-fwaas/run.yaml
    post-run: playbooks/tempest-aio-fwaas/post.yaml
    nodeset: devstack-single-node
    vars:
      vsp_release: '6.0'
      job_flavor: fwaas
      branch_override: default
    timeout: 9000
    override-checkout: stable/queens
    required-projects:
      - OpenStack/nuage-gate-utils
      - name: OpenStack/nuage-openstack-neutron
        override-checkout: 6.0/queens
      - name: OpenStack/nuage-openstack-neutronclient
        override-checkout: 6.0/queens
      - OpenStack/nuage-tempest-plugin
      - opendev.org/openstack/neutron-fwaas
      - name: opendev.org/openstack/neutron-tempest-plugin
        override-checkout: 0.3.0
      - opendev.org/openstack/tempest

- job:
    name: legacy-tempest-aio-client  # used by nuage-openstack-neutronclient
    parent: legacy-dsvm-base
    run: playbooks/tempest-aio-ml2/run.yaml
    post-run: playbooks/tempest-aio-ml2/post.yaml
    nodeset: devstack-single-node
    vars:
      vsp_release: '6.0'
      job_flavor: neutronclient
      python3: False
      branch_override: default
    timeout: 9000
    override-checkout: stable/queens
    required-projects:
      - OpenStack/nuage-gate-utils
      - name: OpenStack/nuage-openstack-neutron
        override-checkout: 6.0/queens
      - name: OpenStack/nuage-openstack-neutronclient
        override-checkout: 6.0/queens
      - OpenStack/nuage-tempest-plugin
      - name: opendev.org/openstack/neutron-tempest-plugin
        override-checkout: 0.3.0
      - opendev.org/openstack/tempest

- job:
    name: networking-nuage-tempest-smoke-multiversion
    parent: networking-nuage-tempest-smoke
    vars:
      vsp_release: '5.4'
      ci_vsp_name: ci-vsp-multiversion
      devstack_localrc:
        TEMPEST_PLUGINS: '"/opt/stack/nuage-tempest-plugin /opt/stack/neutron-tempest-plugin"'
      devstack_local_conf:
        test-config:
          $TEMPEST_CONFIG:
            nuage_sut:
              nuage_pat_legacy: disabled
      tempest_test_regex: '^(nuage_tempest_plugin|tempest\.api\.network|neutron_tempest_plugin\.(api|scenario))\..*\[(?=.*smoke)'
      tempest_test_blacklist: "{{devstack_base_dir}}/nuage-tempest-plugin/tempest-blacklist.txt"
    override-checkout: stable/queens
    required-projects:
      - name: OpenStack/nuage-openstack-neutron
        override-checkout: '5.4/queens'
      - name: OpenStack/nuage-openstack-neutronclient
        override-checkout: '5.4/queens'
      - name: OpenStack/nuage-tempest-plugin
        override-checkout: '5.4'
      - name: opendev.org/openstack/neutron-tempest-plugin
        override-checkout: 0.3.0

